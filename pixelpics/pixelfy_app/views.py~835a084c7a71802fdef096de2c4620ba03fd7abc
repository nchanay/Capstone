from django.shortcuts import render, get_object_or_404, redirect
from django.contrib.auth.decorators import login_required, user_passes_test
from django.http import HttpResponse
from .models import *
import base64
from django.core.files.base import ContentFile

# Create your views here.
def index(request):
    feed = Pixelfy.objects.all().order_by('-created_date')
    return render(request, 'pixelfy_app/index.html', {'posts': feed})


@login_required
def upload(request):
    if request.method == "POST":
        original = request.FILES['original_image']
        ext, altered_b64 = request.POST['altered_image'].split(';base64,') 
        ext = ext.split('/')[-1] 
        altered = ContentFile(base64.b64decode(altered_b64), name='temp.' + ext) # You can save this as file instance.

        print(original, type(original))
        print(original, type(altered))
        post = Pixelfy(user=request.user, original_image=original, altered_image=altered)
        post.save()
        return redirect('profile')
    return render(request, 'pixelfy_app/upload.html')


# def saveImage(request):
#     if request.method == "POST":
#         data = request.post.data
#         print(data)
#         print(request.POST)
#         print(request.body)
#         post = Pixelfy(user=request.user, original_image=data[original_image], altered_image=data[altered_image])
#         post.save()
#     return redirect('profile.html')
